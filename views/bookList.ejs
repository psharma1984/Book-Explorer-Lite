<%- include("partials/head.ejs") %>
<%- include("partials/header.ejs") %>
<!-- Search Form -->
<form action="/books/search" method="POST">
    <div class="row g-3 align-items-center">
    <input type="hidden" name="_csrf" value="<%= _csrf %>">
      <div class="col-auto">
        <input type="text" class="form-control" name="search" placeholder="Search...">
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-secondary">Search</button>    </div>
      </div>
    </div>
  </form>

<div>
  <p><a href="/books/favoriteList"> Favorites</a></p>
</div>


<div class="container">
  <div class="row">
   <% if (books && books.length) { %>
      <% const displayBooks = books.slice(0, 24); %>
        <div class="col-12 mb-3">
          <div class="row">
          <% displayBooks.forEach((book) => { %> 
            <div class="col-12 col-md-4 col-lg-2 mb-3 d-flex flex-column align-items-center justify-content-center">   
              <div class="mb-3 ">
                <div class="d-flex align-items-center justify-content-center" style="height: 180px;">       
                  <img src="<%= book.coverImage %>" alt="Book Cover" class="img-fluid" style="max-width: 100%; max-height: 100%;  transition: transform 0.3s ease-in-out;" onclick="navigateToBookDetail('<%= book._id %>')">   
                </div>           
              </div>  
              <form action="/books/favorites/<%= book._id %>" method="POST">
                <input type="hidden" name="_csrf" value="<%= _csrf %>">
                <button type="submit" class="btn btn-success align-self-center">Mark as favorite</button>
              </form>
            </div>
        <% }) %>
        </div>
        </div>
        <!-- Pagination Controls -->
    <div class="col-12">
        <% if (currentPage > 1) { %>
            <a href="?page=<%= currentPage - 1 %>">Previous</a>
        <% } %>

        Page <%= currentPage %> of <%= totalPages %>

        <% if (currentPage < totalPages) { %>
            <a href="?page=<%= currentPage + 1 %>">Next</a>
        <% } %>

    </div>
      <% } else { %>
      <div class="col-12">
        <p>No books available</p>
        </div>
      <% } %>
  </div> 
</div>
     <script>
      function navigateToBookDetail(bookId){
        var bookDetailURL = '/books/'+ bookId;
        window.location.href = bookDetailURL;
      }
     </script>
     
<%- include("partials/footer.ejs") %>