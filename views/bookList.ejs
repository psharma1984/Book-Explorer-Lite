<%- include("partials/head.ejs") %>
<%- include("partials/header.ejs") %>
<!-- Search Form -->
<form action="/books/search" method="POST">
    <input type="hidden" name="_csrf" value="<%= _csrf %>">
    <input type="text" name="search" placeholder="Search...">
    <button type="submit">Search</button>
</form>

<h2>Books List</h2>
<div>
  <p>Number of Favorites: <%= user.favorites.length %></p>
</div>
<div class="books-container">
   <% if (books && books.length) { %>
           <% const displayBooks = books.slice(0, 20); %>
        <% displayBooks.forEach((book) => { %>
          <div class="books-box" onclick="navigateToBookDetail('<%= book._id %>')">
            <div class="image-box">
              <img src="<%= book.coverImage %>" alt="Book Cover" style="max-width: 100px;">
            </div>
            <span >
              <%= book.title %>
              <form action="/books/favorites/<%= book._id %>" method="POST">
                <input type="hidden" name="_csrf" value="<%= _csrf %>">
                <button type="submit">Favorites</button>
              </form>
            </span>
          </div>  
        <% }) %>
        <!-- Pagination Controls -->
        <div class="pagination">
        <% if (currentPage > 1) { %>
            <a href="?page=<%= currentPage - 1 %>">Previous</a>
        <% } %>

        Page <%= currentPage %> of <%= totalPages %>

        <% if (currentPage < totalPages) { %>
            <a href="?page=<%= currentPage + 1 %>">Next</a>
        <% } %>

        </div>
      <% } else { %>
        <p>No books available
        </p>
      <% } %>
     </div> 
     <script>
      function navigateToBookDetail(bookId){
        var bookDetailURL = '/books/'+ bookId;
        window.location.href = bookDetailURL;
      }
     </script>
     
<%- include("partials/footer.ejs") %>